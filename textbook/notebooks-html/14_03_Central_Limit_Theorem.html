<div id="ipython-notebook">
            <a class="interact-button" href="http://prob140.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com/prob140/materials&branch=gh-pages&subPath=textbook/14_03_Central_Limit_Theorem.ipynb">Interact</a>
            
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Central-Limit-Theorem">Central Limit Theorem<a class="anchor-link" href="#Central-Limit-Theorem">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As its name implies, this theorem is central to the fields of probability, statistics, and data science. It explains the normal curve that kept appearing in the previous section.</p>
<p>Before we get to the theorem let's recall some facts from Data 8 and from earlier in this course.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Standard-Units">Standard Units<a class="anchor-link" href="#Standard-Units">¶</a></h3><p>As we have seen earlier, a random variable $X$ converted to <em>standard units</em> becomes</p>
$$
Z = \frac{X - \mu_X}{\sigma_X}
$$<p>$Z$ measures how far $X$ is from the mean, in units of the SD. In other words $Z$ measures how many SDs above average the value of $X$ is.</p>
<p>By linear function rules,
$$
E(Z) = 0 ~~~ \text{and} ~~~ SD(Z) = 1
$$
no matter what the distribution of $X$.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Standard-Normal-Curve">The Standard Normal Curve<a class="anchor-link" href="#The-Standard-Normal-Curve">¶</a></h3><p>Recall from Data 8 that the standard normal curve is defined by a function often denoted by $\phi$, the lower case Greek letter phi.</p>
$$
\phi(z) = \frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}z^2}, ~~~ -\infty &lt; z &lt; \infty
$$</div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_5_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The curve is symmetric about 0. Its points of inflection are at $z=-1$ and $z=1$. You observed this in Data 8 and can prove it by calculus.</p>
<p><strong>A Note on Terminology.</strong> We will say that the curve has <em>location</em> parameter 0 and <em>scale</em> parameter 1. We will also use the terms <em>mean</em> for the location and <em>SD</em> for the scale, by analogy with the mean and SD of a random variable in standard units. Later in the course, we will show that this is consistent with definitions of the mean and SD of random variables that have a continuum of values.</p>
<p>The total area under the curve is 1. This requires some work to prove. You might have seen it in a calculus class. We will prove it later in the course by using probability methods.</p>
<p>If the distribution of a random variable $X$ is roughly bell shaped, then the distribution of the standardized variable $Z$ roughly follows the standard normal curve above.</p>
<p>Notice that there is almost no probability outside the range $(-3, 3)$. Recall the following figures from Data 8.</p>
<ul>
<li>Area between -1 and 1: about 68%</li>
<li>Area between -2 and 2: about 95%</li>
<li>Area between -3 and 3: about 99.73%</li>
</ul></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Normal-Curves">Normal Curves<a class="anchor-link" href="#Normal-Curves">¶</a></h3><p>The standard normal curve is one of a <em>family</em> of normal curves, each identified by its location and scale parameters, also known as its mean and SD.</p>
<p>The normal curve with mean $\mu$ and SD $\sigma$ is defined by
$$
f(x) ~ = ~ \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{1}{2}(\frac{x-\mu}{\sigma})^2}, ~~~ -\infty &lt; x &lt; \infty
$$</p></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_8_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The shape looks exactly the same as the standard normal curve. The only difference is in the scales of measurement on the axes. The center is now $\mu$ instead of 0, and the points of inflection are at a distance of $\sigma$ away from the center instead of 1.</p>
<p>Now for the reason why the normal curve is important:</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Central-Limit-Theorem">The Central Limit Theorem<a class="anchor-link" href="#The-Central-Limit-Theorem">¶</a></h3><p>Let $X_1, X_2, \ldots$ be i.i.d., each with mean $\mu$ and SD $\sigma$. Let $S_n = X_1 + X_2 + \cdots + X_n$. We know that</p>
$$
E(S_n) = n\mu ~~~~~~~~~~ SD(S_n) = \sqrt{n}\sigma
$$<p>What we don't yet know is the shape of the distribution of $S_n$. The <em>Central Limit Theorem</em> (CLT) tells us the rough shape when $n$ is large.</p>
<h4 id="The-Theorem">The Theorem<a class="anchor-link" href="#The-Theorem">¶</a></h4><p>When $n$ is large, the distribution of the standardized sum 
$$
\frac{S_n - n\mu}{\sqrt{n}\sigma}
$$
approximately follows the standard normal curve, regardless of the common distribution of the $X_i$'s.</p>
<p>In other words, when $n$ is large, the distribution of $S_n$ is roughly normal with mean $n\mu$ and SD $\sqrt{n}\sigma$, regardless of the distribution of the $X_i$'s.</p>
<p>The Central Limit Theorem is the primary reason for using the SD as the measure of the spread of a distribution.</p>
<p>Exactly how large $n$ has to be for the approximation to be good does depend on the distribution of $X_i$. We will say more about that later. For now, assume that the sample sizes we are using are large enough for the normal approximation to be reasonable.</p>
<p>The proof of this theorem is beyond the scope of this course. But you have seen plenty of evidence for it in the simulations done in Data 8 and in the exact distributions of sums computed in the previous section.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example">Example<a class="anchor-link" href="#Example">¶</a></h4><p>Suppose the weights of a sample of 100 people are i.i.d. with a mean of 150 pounds and an SD of 15 pounds. Then the total weight of the sampled people is roughly normal with mean $100 \times 150 = 15,000$ pounds and SD $\sqrt{100} \times 15 = 150$ pounds.</p>
<p>Who cares about the total weight of a random group of people? Ask those who construct stadiums, elevators, and airplanes.</p>
<p>You can plot this distribution using the <code>prob140</code> method <code>Plot_norm</code>. The arguments are the interval over which you want the curve to be drawn, the mean, and the SD.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">mu</span>
<span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span>

<span class="n">plot_interval</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">(</span><span class="n">mean</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">mean</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">sd</span><span class="p">)</span>

<span class="n">Plot_norm</span><span class="p">(</span><span class="n">plot_interval</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_12_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Probabilities-Under-the-Normal-Curve">Probabilities Under the Normal Curve<a class="anchor-link" href="#Probabilities-Under-the-Normal-Curve">¶</a></h3><p>Suppose we want to find the chance that the total weight of the sampled people is less than 15,100 pounds. That is approximately the gold area below. The approximation is in the use of the normal curve.</p>
<p>Notice the argument <code>right_end=15100</code>. That tells <code>Plot_norm</code> the right end of the interval to shade. If there is no left end specified, it is taken to be the left end of the plot interval.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Plot_norm</span><span class="p">(</span><span class="n">plot_interval</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">right_end</span><span class="o">=</span><span class="mi">15100</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_14_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As before, the function that returns all the probability to the left of a point is called the <em>cumulative distribution function</em> (cdf) of the distribution. Call <code>stats.norm.cdf</code> with the appropriate parameters to see that the chance is just under 75%.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">15100</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.74750746245307709</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Approximately what is the chance that the total weight is between 14,800 pounds and 15,100 pounds? Now we specify both <code>left_end</code> and <code>right_end</code>:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Plot_norm</span><span class="p">(</span><span class="n">plot_interval</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">left_end</span><span class="o">=</span><span class="mi">14800</span><span class="p">,</span> <span class="n">right_end</span><span class="o">=</span><span class="mi">15100</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_18_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The shaded area is about 65.6%.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">15100</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">14800</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.65629624272720921</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Standard-Normal-CDF-$\Phi$">The Standard Normal CDF $\Phi$<a class="anchor-link" href="#The-Standard-Normal-CDF-$\Phi$">¶</a></h3><p>There is really only one normal curve that matters – the standard normal curve. All the others are obtained by linear transformations of the horizontal axis. Therefore all the calculations above can be done in terms of the standard normal cdf by standardizing, as follows.</p>
<p>To find the approximate chance that the total weight is less than 15,100 pounds, first standardize the weight and then use the standard normal cdf.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z_right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15100</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">sd</span>

<span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z_right</span><span class="p">)</span>  <span class="c1"># The standard curve is the default</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.74750746245307709</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find the approximate chance that the total weight is between 14,800 pounds and 15,100 pounds:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14800</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">sd</span>

<span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z_right</span><span class="p">)</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z_left</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.65629624272720921</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A common notation for the standard normal cdf is the upper case letter $\Phi$, because it is the integral of $\phi$:</p>
$$
\Phi(x) = \int_{-\infty}^x \phi(z)dz, ~~~~ -\infty &lt; x &lt; \infty
$$<p>This integral, while finite, does not have a closed form formula that can be written in terms of arithmetic operations, powers, trigonometric functions, exponential and logarithmic functions, and composition. It has to be approximated by numerical integration. That is why every statistical system has a built-in function such as <code>stats.norm.cdf</code> that provides excellent approximations.</p>
<p>Standardizing and the standard normal cdf $\Phi$ together provide a compact notation for areas under all normal curves. We don't have to use different functions for different values of the parameters.</p>
<p>Under the assumptions of the CLT, for large $n$ we have the approximation</p>
$$
P(S_n \le x) ~ \approx ~ \Phi \big{(} \frac{x - n\mu}{\sqrt{n}\sigma} \big{)} ~~~ \text{for all } x
$$<p>As you saw in Data 8, approximations often don't do well in the tails of distributions. If you use the CLT to approximate probabilities of regions that are in the tails, be aware that the approximations might be very rough.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Approximating-the-Binomial-$(n,-p)$-Distribution">Approximating the Binomial $(n, p)$ Distribution<a class="anchor-link" href="#Approximating-the-Binomial-$(n,-p)$-Distribution">¶</a></h3><p>A binomial $(n, p)$ random variable is the sum of $n$ i.i.d. indicators. If $n$ is large, the CLT says the distribution should be roughly normal, no matter what $p$ is. But we said in Chapter 6 that if $n$ is large and $p$ is small, then the binomial distribution is roughly Poisson.</p>
<p>So which is it: normal or Poisson? Here are two binomial histograms, both of which have large $n$ but rather different shapes.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
<span class="n">probs1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">binom_fair</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">probs1</span><span class="p">)</span>
<span class="n">Plot</span><span class="p">(</span><span class="n">binom_fair</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Binomial (100, 0.5)'</span><span class="p">);</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_27_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">probs2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">binom_biased</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">probs2</span><span class="p">)</span>
<span class="n">Plot</span><span class="p">(</span><span class="n">binom_biased</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Binomial (100, 0.1)'</span><span class="p">);</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_28_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The difference is due to the spread of the distributions. The Poisson approximation applies when the distribution is scrunched up near 0. When the spread is larger so that there are a substantial number of possible values on either side of the mean, then the normal approximation is the one to try.</p>
<p>To quantify this, many texts give a rough threshold depending on $n$ and $p$ so that if $n$ larger than the threshold then the binomial $(n, p)$ distribution is roughly normal. If $n$ is large and the binomial distribution resembles a Poisson, that means $n$ hasn't crossed the threshold for the normal approximation.</p>
<p>The threshold is variously stated as "the SD $\sqrt{npq}$ is greater than 3" or "both $np$ and $nq$ are greater than 10", which are not exactly the same but pretty close.</p>
<p>You can see what you think of these guidelines, by comparing the total variation distance between the binomial and the corresponding Poisson and the total variation distance between the binomial and the corresponding normal. However, in this course the choice of the normal versus the Poisson approximation to the binomial is rarely going to be a problem, because when the values of $n$ and $p$ are such that you have a doubt about which to use, then you are just going to use the exact binomial probabilities.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is the binomial (100, 0.5) distribution and the approximating normal curve. The parameters of the curve are $np = 50$ and $\sqrt{npq} = 5$.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Plot</span><span class="p">(</span><span class="n">binom_fair</span><span class="p">)</span>
<span class="n">Plot_norm</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Binomial (100, 0.5) and its Normal Approximation'</span><span class="p">);</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/14_03_Central_Limit_Theorem_31_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how the points "$\mbox{mean } \pm \mbox{ SD}$" $= 50 \pm 5$ are the points of inflection of the curve.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div></div></div></div>