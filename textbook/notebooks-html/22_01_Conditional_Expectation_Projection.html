<div id="ipython-notebook">
            <a class="interact-button" href="http://prob140.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com/prob140/materials&branch=gh-pages&subPath=textbook/22_01_Conditional_Expectation_Projection.ipynb">Interact</a>
            
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conditional-Expectation-As-a-Projection">Conditional Expectation As a Projection<a class="anchor-link" href="#Conditional-Expectation-As-a-Projection">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we are trying to predict the value of a random variable $Y$ based on a related random variable $X$. As you saw in Data 8, a natural method of prediction is to use the "center of the vertical strip" at the given value of $X$.</p>
<p>Formally, given $X=x$, we are proposing to predict $Y$ by $E(Y \mid X=x)$.</p></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/22_01_Conditional_Expectation_Projection_5_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The conditional expectation $E(Y \mid X)$ is the function of $X$ defined by</p>
$$
b(x) ~ = ~ E(Y \mid X = x)
$$<p>We are using the letter $b$ to signifiy the "best guess" of $Y$ given the value of $X$. Later in this chapter we will make precise the sense in which it is the best.</p>
<p>In random variable notation,
$$
E(Y \mid X) ~ = ~ b(X)
$$</p>
<p>For a point $(X, Y)$, the error in this guess is</p>
$$
D_w = Y - b(X)
$$<p>The subscript $w$ reminds us that this error is a deviation <em>within</em> a vertical strip – it is the difference between $Y$ and the center of the strip at the given value of $X$.</p></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/22_01_Conditional_Expectation_Projection_7_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find properties of $b(X)$ as an estimate of $Y$ it will be helpful to recall some properties of conditional expectation.</p>
<h3 id="Conditional-Expectation:-Review">Conditional Expectation: Review<a class="anchor-link" href="#Conditional-Expectation:-Review">¶</a></h3><p>The properties of conditional expectation are analogous to those of expectation, but the identities are of random variables, not real numbers. There are also some additional properties due to the aspect of conditioning. We provide a list of the properties here for ease of reference.</p>
<ul>
<li><strong>Linear transformation</strong>: $E(aY + b \mid X) ~ = ~ aE(Y \mid X) + b$</li>
<li><strong>Additivity</strong>: $E(Y + W \mid X) ~ = ~ E(Y \mid X) + E(W \mid X)$</li>
<li><strong>"The given variable is a constant"</strong>: $E(g(X) \mid X) ~ = ~ g(X)$</li>
<li><strong>"Pulling out" constants</strong>: $E(g(X)Y \mid X) ~ = ~ g(X)E(Y \mid X)$</li>
<li><strong>Independence</strong>: If $X$ and $Y$ are independent then $E(Y \mid X) = E(Y)$, a constant.</li>
<li><strong>Iteration</strong>: $E(Y) = E\big{(}E(Y \mid X)\big{)}$</li>
</ul>
<p>Now
$$
E(D_w \mid X) ~ = ~ E(Y \mid X) - E(b(X) \mid X) ~ = ~ b(X) - b(X) = 0
$$</p>
<p>In other words, the average of the deviations within a strip is 0.</p>
<p>By iteration,
$$
E(D_w) ~ = ~ 0 ~~~~~~ \text{and} ~~~~~~ E\big{(}b(X)\big{)} = E(Y)
$$</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="$D_w$-and-Functions-of-$X$">$D_w$ and Functions of $X$<a class="anchor-link" href="#$D_w$-and-Functions-of-$X$">¶</a></h3><p>Let $g(X)$ be any function of $X$. Then the covariance of $g(X)$ and $D_w$ is</p>
$$
Cov\big{(}g(X), D_w\big{)} ~ = ~ E\big{(}g(X)D_w\big{)} 
$$<p>because $E(D_w) = 0$. By iteration,</p>
\begin{align*}
E(g(X)D_w) ~ &amp;= ~ E\big{(}E(g(X)D_w \mid X)\big{)}\\
&amp;= ~ E\big{(}g(X)E(D_w \mid X)\big{)}\\
&amp;= ~ 0
\end{align*}<p>Thus the deviation from the conditional mean, which we have denoted $D_w$, <strong>is uncorrelated with functions of $X$</strong>.</p>
<p>This is a powerful <em>orthogonality</em> property that will be used repeatedly in this chapter. As an informal visual image, think of the space of all possible functions of $X$ to be the surface of a table. Imagine $Y$ to be a point above the table. To predict $Y$ by a function of $X$ it makes sense to find the point on the table that is closest to $Y$. So drop the perpendicular from $Y$ to the table.</p>
<ul>
<li>The point where the perpendicular hits the table is $b(X)$. We say that the conditional expectation of $Y$ given $X$ is the <em>projection</em> of $Y$ on the space of functions of $X$.</li>
<li>$D_w$ is the perpendicular; it is orthogonal to the table.</li>
</ul>
<p>Later in this chapter we will see in exactly what sense $b(X)$ is the best guess for $Y$.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div></div></div></div>